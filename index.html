<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å„¿ç«¥é•¿é«˜ä¹ æƒ¯å…»æˆè®°</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
       .completed td:not(.merged-cell) {
            background-color: #e6ffe6;
        }
        .checkbox {
            transform: scale(1.5);
            cursor: pointer;
        }
        .controls {
            text-align: center;
            margin-bottom: 20px;
        }
        button {
            padding: 8px 16px;
            margin: 0 10px;
            cursor: pointer;
        }
        .clickable-day {
            color: #1a73e8;
            cursor: pointer;
            text-decoration: none;
            font-weight: bold;
        }
        .clickable-day:hover {
            text-decoration: underline;
        }
        .progress-container {
            margin: 20px 0;
            text-align: center;
        }
        .progress-bar {
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: #4CAF50;
            width: 0%;
            transition: width 0.3s;
        }
        .step-text {
            width: 100%;
            text-align: center;
            padding: 8px;
            box-sizing: border-box;
            cursor: pointer;
            position: relative;
        }
        .step-text:hover {
            background-color: #f5f5f5;
        }
        .step-edit {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .step-edit-area {
            width: 100%;
            height: 80px;
            padding: 8px;
            box-sizing: border-box;
            resize: vertical;
        }
        .step-edit-buttons {
            display: flex;
            gap: 8px;
            justify-content: center;
        }
        .step-edit-btn {
            padding: 4px 12px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        .step-save {
            background-color: #4CAF50;
            color: white;
        }
        .step-cancel {
            background-color: #f44336;
            color: white;
        }
        .merged-cell {
            vertical-align: middle;
        }
        .note {
            width: 100%;
            min-height: 40px;
            border: none;
            padding: 5px;
            box-sizing: border-box;
            font-family: inherit;
            font-size: inherit;
            text-align: center;
            background: transparent;
            overflow-y: hidden;
            word-wrap: break-word;
            white-space: pre-wrap;
            resize: none;
            height: auto;
        }
        .note:focus {
            outline: 1px solid #4CAF50;
            background: white;
        }
        .date-cell {
            min-width: 80px;
        }
        .promo-links {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .promo-link {
            margin: 3px 0;
        }
    </style>
</head>
<body>
    <h1>å„¿ç«¥é•¿é«˜ä¹ æƒ¯å…»æˆè®°</h1>
    
    <div class="progress-container">
        <div>å·²å®Œæˆ: <span id="completedDays">0</span>/<span id="totalDays">0</span> å¤©</div>
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
    </div>
    
    <div class="controls">
        <button id="saveBtn">ä¿å­˜è¿›åº¦</button>
        <button id="resetBtn">é‡ç½®å…¨éƒ¨</button>
        <button id="printBtn">æ‰“å°è¡¨æ ¼</button>
    </div>
    
    <table id="checklist">
        <thead>
            <tr>
                <th width="25%">å‚è€ƒèµ„æ–™</th>
                <th width="25%">æ¯æ—¥æ­¥éª¤</th>
                <th width="15%">å®ŒæˆçŠ¶æ€</th>
                <th width="15%">å®Œæˆæ—¥æœŸ</th>
                <th width="20%">å¤‡æ³¨</th>
            </tr>
        </thead>
        <tbody>
            <!-- ä½¿ç”¨JavaScriptåŠ¨æ€ç”Ÿæˆæ‰“å¡è¡Œ -->
        </tbody>
    </table>

    <script>
        const tbody = document.querySelector('#checklist tbody');
        let totalDays = 0;
        
        // æŒ‰ç»„å­˜å‚¨æ­¥éª¤å’Œå‚è€ƒèµ„æ–™ï¼ˆæ”¹è¿›ä¸ºæ•°ç»„ç»“æ„ï¼‰
        const originalGroups = [
            {
                id: 1,
                links: [
                    { label: "å„¿ç«¥é’å°‘å¹´èº«é«˜å‘è‚²æ›²çº¿", url: "https://sandy-long.github.io/H-h/" },
                    { label: "å¹´é¾„èº«é«˜å¥åº·å»ºè®®", url: "https://sandy-long.github.io/H-hc/" }
                ],
                steps: [
                    "å¹´é¾„",
                    "å½“å‰èº«é«˜",
                    "15å¤©å",
                    "1ä¸ªæœˆå",
                    "2ä¸ªæœˆå",
                    "3ä¸ªæœˆå",
                    "6ä¸ªæœˆå",
                    "1å¹´å",
                ]
            },
            {
                id: 2,
                links: [
                    { label: "å„¿ç«¥é«˜æ•ˆ'é•¿é«˜'è›‹ç™½é£Ÿæè¥å…»", url: "https://sandy-long.github.io/H-meat/" },
                    { label: "æ°¨åŸºé…¸äº’è¡¥é…é¤å»ºè®®", url: "https://sandy-long.github.io/H-Pmeal/" }
                ],
                steps: [
                    "äº†è§£å„¿ç«¥é«˜æ•ˆ'é•¿é«˜'è›‹ç™½é£Ÿæ",
                    "å­¦åšä¸‰æ–‡é±¼/é»‘é±¼/è™¾çš®è’¸è›‹",
                    "å­¦åšè“è“æ¬§åŒ…",
                    "å­¦åšéŸ©å¼æ‹Œé¥­å°é±¼å¹²",
                    "å­¦åšé¸¡èƒ¸è‚‰æ‹Œè¥¿å…°èŠ±",
                    "å­¦åšç•ªèŒ„åœŸè±†ç‚–ç‰›è…©",
                    "å­¦åšé±¼å¤´è±†è…æ±¤",
                    "å­¦åšç³–é†‹é‡Œè„Š"
                ]
            },
            {
                id: 3,
                links: [
                    { label: "è›‹ç™½è´¨æ‘„å–æ—¶é—´åˆ†é…", url: "https://sandy-long.github.io/H-time/" },
                    { label: "è›‹ç™½è´¨è®¡ç®—æ‘„å…¥é‡", url: "https://sandy-long.github.io/H-Pro/" }
                ],
                steps: ["æ—©é¤è›‹ç™½", "åˆé¤è›‹ç™½", "åŠ é¤è›‹ç™½", "æ™šé¤è›‹ç™½"]
            },
            {
                id: 4,
                links: [
                    { label: "è›‹ç™½è´¨ä¸ç»´ç”Ÿç´ ååŒä½œç”¨", url: "https://sandy-long.github.io/H-vit/" },
                    { label: "æ—¥ç…§è¡¥ç»´Dè¦æ€æ ·æ™’ï¼Ÿ", url: "https://sandy-long.github.io/H-VD/" },
                    { label: "å¯Œå«VDçš„é£Ÿç‰©åŠè®¡ç®—", url: "https://sandy-long.github.io/H-VDf/" },
                    { label: "å¯Œå«VCçš„é£Ÿç‰©åŠè®¡ç®—", url: "https://sandy-long.github.io/H-VC/" }
                ],
                steps: [
                    "å­¦åšå¥¶é…ªé¸¡è›‹å·",
                    "å­¦åšç˜¦ç‰›è‚‰ç‚’å½©æ¤’",
                    "ä¸‰æ–‡é±¼ç™½ç‰è‡ç‚’é¥­",
                    "æœ‰æ™’å¤ªé˜³å—ï¼Ÿä¸æ™’å¤ªé˜³å°å¿ƒVDä¸è¶³å“¦"
                ]
            },
            {
                id: 5,
                links: [
                    { label: "é’™ç£·å¹³è¡¡ä¸è›‹ç™½è´¨é£Ÿç‰©æ­é…", url: "https://sandy-long.github.io/H-CaP/" },
                    { label: "å¯Œå«é’™çš„é£Ÿç‰©åŠè®¡ç®—", url: "https://sandy-long.github.io/H-Ca/" },
                    { label: "é’™ç£·å¹³è¡¡é£Ÿç‰©ç»„åˆè®¡ç®—", url: "https://sandy-long.github.io/H-CP/" }
                ],
                steps: [
                    "æ— è›‹ç™½æ¥æºç£·ï¼Œå®¹æ˜“æ‰°ä¹±é’™ç£·æ¯”ä¾‹ï¼Œå½±å“é•¿é«˜å“¦ï¼ï¼ï¼<br><strong>ä½ ä»Šå¤©å–ç¢³é…¸é¥®æ–™äº†å—</strong>",
                    "å‡‰æ‹Œ<strong>èŠéº»</strong>è’œæ³¥<strong>è èœ</strong><br>(10gï¼š200g)",
                    "<strong>è™¾çš®è±†è…</strong>è’¸<strong>è›‹</strong><br>(5gï¼š100gï¼š50g)"
                ]
            },
            {
                id: 6,
                links: [
                    { label: "è›‹ç™½è´¨ä¸è¿åŠ¨ååŒä¿ƒè¿›éª¨éª¼ç”Ÿé•¿", url: "https://sandy-long.github.io/H-sport/" },
                    { label: "è¿åŠ¨è§„åˆ’å»ºè®®åŠ©æ‰‹", url: "https://sandy-long.github.io/H-SP/" }
                ],
                steps: ["è·†æ‹³é“", "ç¾½æ¯›çƒ", "ç¯®çƒ", "æ»‘è½®"]
            },
            {
                id: 7,
                links: [
                    { label: "å„¿ç«¥ç¡çœ ä¿ƒè¿›é•¿é«˜", url: "https://sandy-long.github.io/H-sleep/" },
                    { label: "å„¿ç«¥ç¡çœ ä¿ƒè¿›é•¿é«˜åŠ©æ‰‹", url: "https://sandy-long.github.io/H-slc/" }
                ],
                steps: ["ä¹ æƒ¯å‡ ç‚¹ç¡è§‰", "ç¡çœ æ—¶é—´", "åˆä¼‘æ—¶é—´","ç¡å‰å‡†å¤‡"]
            }
        ];

        // ä½¿ç”¨å‰¯æœ¬è¿›è¡Œæ“ä½œï¼Œä¿ç•™åŸå§‹æ•°æ®
        let groups = JSON.parse(JSON.stringify(originalGroups));

        // è®¡ç®—æ€»å¤©æ•°
        function calculateTotalDays() {
            totalDays = groups.reduce((count, group) => count + group.steps.length, 0);
            document.getElementById('totalDays').textContent = totalDays;
            return totalDays;
        }

        // ç”Ÿæˆè¡¨æ ¼ï¼ˆä¼˜åŒ–æ”¯æŒæ— é™æ·»åŠ ï¼‰
        function generateTable() {
            tbody.innerHTML = '';
            let globalDayIndex = 1;
            
            groups.forEach(group => {
                const steps = group.steps || [];
                const links = group.links || [];
                
                if (steps.length === 0) return;
                
                for (let i = 0; i < steps.length; i++) {
                    const row = document.createElement('tr');
                    const stepContent = steps[i];
                    
                    // å‚è€ƒèµ„æ–™å•å…ƒæ ¼ï¼ˆä»…ç¬¬ä¸€è¡Œæ˜¾ç¤ºï¼Œrowspanåˆå¹¶ï¼‰
                    if (i === 0) {
                        const linksHtml = links.map(link => 
                            `<div class="promo-link"><a href="${link.url}" class="clickable-day" target="_blank">${link.label}</a></div>`
                        ).join('');
                        
                        row.innerHTML = `
                            <td rowspan="${steps.length}" class="merged-cell">
                                <div class="promo-links">
                                    ${linksHtml}
                                </div>
                            </td>
                            <td>
                                <div class="step-text" data-group="${group.id}" data-index="${i}">
                                    ${stepContent}
                                </div>
                                <div class="step-edit" style="display:none;">
                                    <textarea class="step-edit-area">${stepContent}</textarea>
                                    <div class="step-edit-buttons">
                                        <button class="step-edit-btn step-save" data-group="${group.id}" data-index="${i}">ä¿å­˜</button>
                                        <button class="step-edit-btn step-cancel" data-group="${group.id}" data-index="${i}">å–æ¶ˆ</button>
                                    </div>
                                </div>
                            </td>
                            <td><input type="checkbox" class="checkbox" id="day${globalDayIndex}" data-group="${group.id}" data-step="${i}"></td>
                            <td class="date-cell"></td>
                            <td><textarea class="note" data-day="${globalDayIndex}"></textarea></td>
                        `;
                    } else {
                        row.innerHTML = `
                            <td>
                                <div class="step-text" data-group="${group.id}" data-index="${i}">
                                    ${stepContent}
                                </div>
                                <div class="step-edit" style="display:none;">
                                    <textarea class="step-edit-area">${stepContent}</textarea>
                                    <div class="step-edit-buttons">
                                        <button class="step-edit-btn step-save" data-group="${group.id}" data-index="${i}">ä¿å­˜</button>
                                        <button class="step-edit-btn step-cancel" data-group="${group.id}" data-index="${i}">å–æ¶ˆ</button>
                                    </div>
                                </div>
                            </td>
                            <td><input type="checkbox" class="checkbox" id="day${globalDayIndex}" data-group="${group.id}" data-step="${i}"></td>
                            <td class="date-cell"></td>
                            <td><textarea class="note" data-day="${globalDayIndex}"></textarea></td>
                        `;
                    }
                    
                    tbody.appendChild(row);
                    globalDayIndex++;
                }
            });
        }

        // åˆå§‹åŒ–ç”Ÿæˆè¡¨æ ¼
        calculateTotalDays();
        generateTable();
        attachEventListeners();
        loadFromLocalStorage();

        // æ›´æ–°è¿›åº¦æ˜¾ç¤º
        function updateProgress() {
            const completed = document.querySelectorAll('.checkbox:checked').length;
            document.getElementById('completedDays').textContent = completed;
            document.getElementById('progressFill').style.width = totalDays > 0 ? `${(completed/totalDays)*100}%` : '0%';
            
            if (completed > 0 && completed === totalDays) {
                alert('æ­å–œæ‚¨å®Œæˆäº†é•¿é«˜è®¡åˆ’ï¼ğŸ‰');
            }
        }

        // é‡ç½®æ‰€æœ‰å†…å®¹
        function resetAll() {
            // æ¢å¤åŸå§‹æ•°æ®
            groups = JSON.parse(JSON.stringify(originalGroups));
            
            // æ¸…é™¤æœ¬åœ°å­˜å‚¨
            localStorage.clear();
            
            // é‡æ–°ç”Ÿæˆè¡¨æ ¼
            calculateTotalDays();
            generateTable();
            attachEventListeners();
            updateProgress();
            
            // æ˜¾ç¤ºé‡ç½®æˆåŠŸæç¤º
            alert('æ‰€æœ‰å†…å®¹å·²é‡ç½®æˆåŠŸï¼');
        }

        // æ‰“å°è¡¨æ ¼
        function printTable() {
            window.print();
        }

        // ä¿å­˜è¿›åº¦
        function saveProgress() {
            // æ•°æ®å·²ç»è‡ªåŠ¨ä¿å­˜åˆ°localStorage
            alert('è¿›åº¦å·²ä¿å­˜ï¼');
        }

        // é™„åŠ äº‹ä»¶ç›‘å¬å™¨
        function attachEventListeners() {
            // å¤é€‰æ¡†çŠ¶æ€æ›´æ–°
            document.querySelectorAll('.checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const groupId = this.dataset.group;
                    const stepIndex = parseInt(this.dataset.step);
                    const row = this.closest('tr');
                    const dateCell = row.querySelector('.date-cell');
                    const noteInput = row.querySelector('.note');
                    const stepText = row.querySelector('.step-text').textContent;
                    
                    if(this.checked) {
                        row.classList.add('completed');
                        const today = new Date();
                        dateCell.textContent = today.toLocaleDateString();
                        saveToLocalStorage(this.id, true, dateCell.textContent, stepText, noteInput.value);
                    } else {
                        row.classList.remove('completed');
                        dateCell.textContent = '';
                        saveToLocalStorage(this.id, false, '', stepText, noteInput.value);
                    }
                    
                    updateProgress();
                });
            });

            // å¤‡æ³¨æ›´æ–°
            document.querySelectorAll('.note').forEach(textarea => {
                textarea.addEventListener('input', function() {
                    const checkbox = document.getElementById(this.dataset.day);
                    const dateCell = this.closest('tr').querySelector('.date-cell');
                    const stepText = this.closest('tr').querySelector('.step-text').textContent;
                    saveToLocalStorage(this.dataset.day, checkbox.checked, dateCell.textContent, stepText, this.value);
                });
                
                textarea.addEventListener('change', function() {
                    this.style.height = 'auto';
                    this.style.height = (this.scrollHeight) + 'px';
                });
            });

            // é‡ç½®æŒ‰é’® - ä¸€é”®é‡ç½®æ‰€æœ‰å†…å®¹
            document.getElementById('resetBtn').addEventListener('click', resetAll);

            // ä¿å­˜æŒ‰é’® - ä¸€é”®ä¿å­˜
            document.getElementById('saveBtn').addEventListener('click', saveProgress);

            // æ‰“å°æŒ‰é’® - ä¸€é”®æ‰“å°
            document.getElementById('printBtn').addEventListener('click', printTable);
            
            // æ­¥éª¤ç¼–è¾‘ç›¸å…³äº‹ä»¶
            document.querySelectorAll('.step-text').forEach(stepDiv => {
                stepDiv.addEventListener('click', function() {
                    const container = this.parentElement;
                    const stepEdit = container.querySelector('.step-edit');
                    const stepEditArea = stepEdit.querySelector('.step-edit-area');
                    
                    // ä¿å­˜åŸå§‹å€¼
                    stepEdit.dataset.original = this.innerHTML;
                    stepEditArea.value = this.innerHTML;
                    
                    // åˆ‡æ¢æ˜¾ç¤º
                    this.style.display = 'none';
                    stepEdit.style.display = 'flex';
                });
            });
            
            // ä¿å­˜æ­¥éª¤ä¿®æ”¹
            document.querySelectorAll('.step-save').forEach(saveBtn => {
                saveBtn.addEventListener('click', function() {
                    const groupId = this.dataset.group;
                    const stepIndex = parseInt(this.dataset.index);
                    const container = this.closest('td');
                    const stepText = container.querySelector('.step-text');
                    const stepEdit = container.querySelector('.step-edit');
                    const stepEditArea = stepEdit.querySelector('.step-edit-area');
                    
                    // æ›´æ–°æ­¥éª¤å†…å®¹å’Œgroupsæ•°ç»„
                    stepText.innerHTML = stepEditArea.value;
                    groups.find(g => g.id == groupId).steps[stepIndex] = stepEditArea.value;
                    
                    // åˆ‡æ¢æ˜¾ç¤º
                    stepEdit.style.display = 'none';
                    stepText.style.display = 'block';
                });
            });
            
            // å–æ¶ˆæ­¥éª¤ä¿®æ”¹
            document.querySelectorAll('.step-cancel').forEach(cancelBtn => {
                cancelBtn.addEventListener('click', function() {
                    const container = this.closest('td');
                    const stepText = container.querySelector('.step-text');
                    const stepEdit = container.querySelector('.step-edit');
                    
                    // æ¢å¤åŸå§‹å€¼
                    stepText.innerHTML = stepEdit.dataset.original;
                    
                    // åˆ‡æ¢æ˜¾ç¤º
                    stepEdit.style.display = 'none';
                    stepText.style.display = 'block';
                });
            });
        }

        // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
        function saveToLocalStorage(id, checked, date, step, note) {
            const data = {
                checked: checked,
                date: date,
                step: step,
                note: note
            };
            localStorage.setItem(id, JSON.stringify(data));
        }

        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®
        function loadFromLocalStorage() {
            document.querySelectorAll('.checkbox').forEach(checkbox => {
                const id = checkbox.id;
                const data = localStorage.getItem(id);
                if (data) {
                    const parsedData = JSON.parse(data);
                    const row = checkbox.closest('tr');
                    const dateCell = row.querySelector('.date-cell');
                    const noteInput = row.querySelector('.note');
                    
                    checkbox.checked = parsedData.checked;
                    if (parsedData.checked) {
                        row.classList.add('completed');
                        dateCell.textContent = parsedData.date;
                    }
                    noteInput.value = parsedData.note || '';
                }
            });
            updateProgress();
            
            // è‡ªé€‚åº”è°ƒæ•´å¤‡æ³¨é«˜åº¦
            document.querySelectorAll('.note').forEach(textarea => {
                textarea.style.height = 'auto';
                textarea.style.height = (textarea.scrollHeight) + 'px';
            });
        }

        // åˆå§‹åŒ–
        window.addEventListener('load', () => {
            calculateTotalDays();
            generateTable();
            attachEventListeners();
        });
    </script>
</body>
</html>